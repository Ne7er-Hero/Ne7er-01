---
- name: vsftpdの設定を変更してサービスを再起動
  hosts: all
  become: true

  tasks:
    - name: vsftpd.confのtcp_wrappersをコメントアウト
      replace:
        path: /etc/vsftpd/vsftpd.conf
        regexp: '^tcp_wrappers=YES'
        replace: '#tcp_wrappers=YES'
        backup: yes   # 変更前のファイルをバックアップする

    - name: vsftpdを再起動
      systemd:
        name: vsftpd
        state: restarted
        enabled: true   # 自動起動を有効にする

    - name: vsftpdのステータス確認
      command: systemctl status vsftpd
      register: vsftpd_status
      changed_when: false   # ステータス確認では変更扱いにしない

    - name: ステータス結果を表示
      debug:
        var: vsftpd_status.stdout_lines
